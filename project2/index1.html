<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Permanent Marker' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            background-color: #721bc4;
            font-family: 'Pacifico';
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            background-color: #a666e3;
            text-shadow: 5px 5px 5px #dfd2ec;
            text-align: center;
            width: 100%;
            margin: 0;
            padding: 20px;
            font-size: 2.5em;
        }
        h3 {
            font-family: 'Permanent Marker';
            text-align: center;
            width: 100%;
            margin: 0;
            padding: 10px;
        }
        canvas {
            animation: mymove 5s infinite;
            border: 5px solid #0a3cda;
            border-style: dotted;
            border-radius: 15px 50px;
            background: url('http://s2js.com/img/etc/flappyback.png') no-repeat center center;
            background-size: cover;
        }
        @keyframes mymove {
            50% {
                box-shadow: 10px 20px 30px blue;
            }
        }
        .score {
            font-size: 2em;
            color: white;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .fullscreen-btn {
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 2em;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1><b>Flappy Bird !!! (game) <div id="div1" class="fa"></div></b></h1>
    <h3><b>If you want to have a very high score, think out of this game!! ~_^ <hr> and tell me your high score</b></h3>
    <div class="fullscreen-btn" id="fullscreen-btn">
        <i class="fa fa-expand" onclick="toggleFullScreen()"></i>
    </div>
    <canvas id="myCanvas" width="320" height="480"></canvas>
    <div class="score">Score: <span id="score">0</span></div>
    <script>
        function smile() {
            var a = document.getElementById("div1");
            a.innerHTML = "&#xf118;";
            setTimeout(function () {
                a.innerHTML = "&#xf11a;";
            }, 1000);
            setTimeout(function () {
                a.innerHTML = "&#xf119;";
            }, 2000);
            setTimeout(function () {
                a.innerHTML = "&#xf11a;";
            }, 3000);
        }
        smile();
        setInterval(smile, 4000);

        var ctx = myCanvas.getContext("2d");
        var FPS = 60;
        var jumpAmount = -10;
        var maxFallSpeed = 10;
        var acceleration = 0.5;
        var pipeSpeed = -3;
        var gameMode = 'prestart';
        var timeGameLastRunning;
        var bottomBarOffset = 0;
        var pipes = [];
        var score = 0;

        function MySprite(imgUrl) {
            this.x = 0;
            this.y = 0;
            this.visible = true;
            this.velocityX = 0;
            this.velocityY = 0;
            this.myImg = new Image();
            this.myImg.src = imgUrl || '';
            this.angle = 0;
            this.flipV = false;
            this.flipH = false;
        }

        MySprite.prototype.doFrameThings = function () {
            ctx.save();
            ctx.translate(this.x + this.myImg.width / 2, this.y + this.myImg.height / 2);
            ctx.rotate(this.angle * Math.PI / 180);
            if (this.flipV) ctx.scale(1, -1);
            if (this.flipH) ctx.scale(-1, 1);
            if (this.visible) ctx.drawImage(this.myImg, -this.myImg.width / 2, -this.myImg.height / 2);
            this.x += this.velocityX;
            this.y += this.velocityY;
            ctx.restore();
        };

        function imagesTouching(thing1, thing2) {
            if (!thing1.visible || !thing2.visible) return false;
            if (thing1.x >= thing2.x + thing2.myImg.width || thing1.x + thing1.myImg.width <= thing2.x) return false;
            if (thing1.y >= thing2.y + thing2.myImg.height || thing1.y + thing1.myImg.height <= thing2.y) return false;
            return true;
        }

        function gotPlayerInput(MyEvent) {
            switch (gameMode) {
                case 'prestart':
                    gameMode = 'running';
                    break;
                case 'running':
                    bird.velocityY = jumpAmount;
                    break;
                case 'over':
                    if (new Date() - timeGameLastRunning > 1000) {
                        resetGame();
                        gameMode = 'running';
                    }
                    break;
            }
            MyEvent.preventDefault();
        }

        addEventListener("touchstart", gotPlayerInput);
        addEventListener("mousedown", gotPlayerInput);
        addEventListener("keydown", gotPlayerInput);

        function makeBirdSlowAndFall() {
            if (bird.velocityY < maxFallSpeed) {
                bird.velocityY += acceleration;
            }
            if (bird.y > myCanvas.height - bird.myImg.height) {
                bird.velocityY = 0;
                gameMode = 'over';
            }
        }

        function addPipe(xPos, topOfGap, gapWidth) {
            var topPipe = new MySprite();
            topPipe.myImg = pipePiece;
            topPipe.x = xPos;
            topPipe.y = topOfGap - pipePiece.height;
            topPipe.velocityX = pipeSpeed;
            pipes.push(topPipe);

            var bottomPipe = new MySprite();
            bottomPipe.myImg = pipePiece;
            bottomPipe.flipV = true;
            bottomPipe.x = xPos;
            bottomPipe.y = topOfGap + gapWidth;
            bottomPipe.velocityX = pipeSpeed;
            pipes.push(bottomPipe);
        }

        function makeBirdTiltAppropriately() {
            if (bird.velocityY < 0) {
                bird.angle = -15;
            } else if (bird.angle < 70) {
                bird.angle += 4;
            }
        }

        function showThePipes() {
            for (var i = 0; i < pipes.length; i++) {
                pipes[i].doFrameThings();
            }
        }

        function checkForEndGame() {
            for (var i = 0; i < pipes.length; i++) {
                if (imagesTouching(bird, pipes[i])) gameMode = "over";
            }
        }

        function displayIntroInstructions() {
            ctx.font = "25px Arial";
            ctx.fillStyle = "red";
            ctx.textAlign = "center";
            ctx.fillText("Press, touch or click to start", myCanvas.width / 2, myCanvas.height / 4);
        }

        function displayGameOver() {
            ctx.font = "30px Arial";
            ctx.fillStyle = "red";
            ctx.textAlign = "center";
            ctx.fillText("Game Over", myCanvas.width / 2, 100);
            ctx.fillText("Score: " + score, myCanvas.width / 2, 150);
            ctx.font = "20px Arial";
            ctx.fillText("Click, touch, or press to play again", myCanvas.width / 2, 300);
        }

        function displayBarRunningAlongBottom() {
            if (bottomBarOffset < -23) bottomBarOffset = 0;
            ctx.drawImage(bottomBar, bottomBarOffset, myCanvas.height - bottomBar.height);
        }

        function resetGame() {
            bird.y = myCanvas.height / 2;
            bird.angle = 0;
            pipes = [];
            score = 0;
            addAllMyPipes();
        }

        function addAllMyPipes() {
            addPipe(500, 100, 140);
            addPipe(800, 50, 140);
            addPipe(1000, 250, 140);
            addPipe(1200, 150, 120);
            addPipe(1600, 100, 120);
            addPipe(1800, 150, 120);
            addPipe(2000, 200, 120);
            addPipe(2200, 250, 120);
            addPipe(2400, 30, 100);
            addPipe(2700, 300, 100);
            addPipe(3000, 100, 80);
            addPipe(3300, 250, 80);
            addPipe(3600, 50, 60);
            var finishLine = new MySprite("http://s2js.com/img/etc/flappyend.png");
            finishLine.x = 3900;
            finishLine.velocityX = pipeSpeed;
            pipes.push(finishLine);
        }

        var pipePiece = new Image();
        pipePiece.onload = addAllMyPipes;
        pipePiece.src = "http://s2js.com/img/etc/flappypipe.png";

        function doAFrame() {
            ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);
            bird.doFrameThings();
            displayBarRunningAlongBottom();
            switch (gameMode) {
                case 'prestart':
                    displayIntroInstructions();
                    break;
                case 'running':
                    timeGameLastRunning = new Date();
                    bottomBarOffset += pipeSpeed;
                    showThePipes();
                    makeBirdTiltAppropriately();
                    makeBirdSlowAndFall();
                    checkForEndGame();
                    score = Math.floor((pipes.filter(pipe => pipe.x < bird.x).length) / 2);
                    document.getElementById('score').innerText = score;
                    break;
                case 'over':
                    makeBirdSlowAndFall();
                    displayGameOver();
                    break;
            }
        }

        var bottomBar = new Image();
        bottomBar.src = "http://s2js.com/img/etc/flappybottom.png";

        var bird = new MySprite("http://s2js.com/img/etc/flappybird.png");
        bird.x = myCanvas.width / 3;
        bird.y = myCanvas.height / 2;

        setInterval(doAFrame, 1000 / FPS);

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                document.getElementById('fullscreen-btn').innerHTML = '<i class="fa fa-compress" onclick="toggleFullScreen()"></i>';
                adjustCanvasSize();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    document.getElementById('fullscreen-btn').innerHTML = '<i class="fa fa-expand" onclick="toggleFullScreen()"></i>';
                    adjustCanvasSize();
                }
            }
        }

        function adjustCanvasSize() {
            if (document.fullscreenElement) {
                myCanvas.width = window.innerWidth;
                myCanvas.height = window.innerHeight;
            } else {
                myCanvas.width = 320;
                myCanvas.height = 480;
            }
        }

        window.onresize = adjustCanvasSize;
    </script>
</body>
</html>
